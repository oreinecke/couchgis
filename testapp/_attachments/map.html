<!DOCTYPE html>

<html lang="de" style="height:90%">
  <head>
    <title>Karte</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">

    <script src="script/jquery-1.10.2.js"></script>
    <script src="script/jquery.couch.js"></script>
    <script src="script/login_bar.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

<script type="text/javascript">
$(document).ready(function() {
  // let's try with only one document for now!!!
  var id="c76eef44f37d9af942135711a602ae3c";
  var parts=window.location.pathname.match(/[^/]+/g);
  var db=$.couch.db(parts[0]);
  var app=parts[2];

  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 8,
    center: new google.maps.LatLng(50.84821949128975, 13.798296875),
    mapTypeId: google.maps.MapTypeId.TERRAIN
  });

  MAP=map; // remove me!!

  var list=function() {
    var parts=window.location.pathname.match(/[^/]+/g);
    var db=$.couch.db(parts[0]);
    var app=parts[2];
    return function(view, data, options) {
      return db.list(app+"/bbox-filter", view, data, options);
    }
  }();

  list("bbox-size", {keys:[id]}, {success:function(data) {
    var bbox=data[id].GeoJSON.bbox;
    map.setCenter(new google.maps.LatLng((bbox[3]+bbox[1])*0.5,(bbox[2]+bbox[0])*0.5));
    map.setZoom(12);
  }});

  list("geojson", {keys:[id], error:0.00005}, {success:function(data) {
    var paths=[];
    var GeoJSON=data[id].GeoJSON;
    for (path=0;path<GeoJSON.coordinates.length;path++) {
      paths.push([]);
      var coords=GeoJSON.coordinates[path];
      for (coord=0;coord<coords.length;coord++) {
        paths[path].push(new google.maps.LatLng(coords[coord][1], coords[coord][0]));
      }
    }
    new google.maps.Polygon({
      paths:paths,
      fillOpacity: 0
    }).setMap(map)
  }});

});
</script>

  </head>
  <body style="height:90%">

  <iframe src="login_bar.htm" style="width:100%; height:1.4em; border:0;"></iframe>

  <h1> Karte </h1>
  <div id="map" style="height:90%"></div>

  </body>
</html>
